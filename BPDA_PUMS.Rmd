---
title: "BPDA_PUMS"
author: "Yirong Yuan"
date: "2022-11-11"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Install tidycensus package and get Census API Key from
http://api.census.gov/data/key_signup.html. 
Please read the instruction 
https://walker-data.com/tidycensus/articles/basic-usage.html
```{r}
library(tidycensus)
Sys.getenv("CENSUS_API_KEY")
```


##Qurerying Data From Census
##PartI Countries' Population Datasets
This example only acquire the data in 2018. When you want to do other years, just 
change year = 2019/2017/.../2005.

```{r}
pop_2018 <- get_pums(
  variables = c("POBP","SEX", "AGEP","MAR","YOEP","CIT","ENG","SCHL","COW","INDP","OCCP","POVPIP","WAGP"),
  state = "all",
  survey = "acs1",
  year = 2018
)
```

##separat different countries' data

```{r}
brazil_pr_2018<- grep("362", 
                   pop_2018$POBP, 
                   ignore.case = T)

brazil_pop_2018 <- pop_2018 %>% slice(brazil_pr_2018, preserve = FALSE)


argentina_pr_2018<- grep("360", 
                      pop_2018$POBP, 
                      ignore.case = T)

argentina_pop_2018 <- pop_2018 %>% slice(argentina_pr_2018, preserve = FALSE)

bolivia_pr_2018<- grep("361", 
                         pop_2018$POBP, 
                         ignore.case = T)

bolivia_pop_2018 <- pop_2018 %>% slice(bolivia_pr_2018, preserve = FALSE)

chile_pr_2018<- grep("363", 
                         pop_2018$POBP, 
                         ignore.case = T)

chile_pop_2018 <- pop_2018 %>% slice(chile_pr_2018, preserve = FALSE)

colombia_pr_2018<- grep("364", 
                         pop_2018$POBP, 
                         ignore.case = T)

colombia_pop_2018 <- pop_2018 %>% slice(colombia_pr_2018, preserve = FALSE)

ecuador_pr_2018<- grep("365", 
                         pop_2018$POBP, 
                         ignore.case = T)

ecuador_pop_2018 <- pop_2018 %>% slice(ecuador_pr_2018, preserve = FALSE)

french_guiana_pr_2018<- grep("367", 
                         pop_2018$POBP, 
                         ignore.case = T)

french_guiana_pop_2018 <- pop_2018 %>% slice(french_guiana_pr_2018, preserve = FALSE)

guyana_pr_2018<- grep("368", 
                             pop_2018$POBP, 
                             ignore.case = T)

guyana_pop_2018 <- pop_2018 %>% slice(guyana_pr_2018, preserve = FALSE)

paraguay_pr_2018<- grep("369", 
                             pop_2018$POBP, 
                             ignore.case = T)

paraguay_pop_2018 <- pop_2018 %>% slice(paraguay_pr_2018, preserve = FALSE)

peru_pr_2018<- grep("370", 
                     pop_2018$POBP, 
                     ignore.case = T)

peru_pop_2018 <- pop_2018 %>% slice(peru_pr_2018, preserve = FALSE)

suriname_pr_2018<- grep("371", 
                     pop_2018$POBP, 
                     ignore.case = T)

suriname_pop_2018 <- pop_2018 %>% slice(suriname_pr_2018, preserve = FALSE)

uruguay_pr_2018<- grep("372", 
                     pop_2018$POBP, 
                     ignore.case = T)

uruguay_pop_2018 <- pop_2018 %>% slice(uruguay_pr_2018, preserve = FALSE)

venezuela_pr_2018<- grep("373", 
                     pop_2018$POBP, 
                     ignore.case = T)

venezuela_pop_2018 <- pop_2018 %>% slice(venezuela_pr_2018, preserve = FALSE)


```
##standard data tidy

```{r}





```

```{r}
age <- brazil_pop_2018[,c("ST","AGEP")]
age$group <- "age_0_to_4"

age[(age$AGEP < 9 & age$AGEP >= 5),"group"] <- "age_5_to_9"
age[(age$AGEP < 19 & age$AGEP >= 10),"group"] <- "age_10_to_19"
age[(age$AGEP < 24 & age$AGEP >= 20), "group"] <- "age_20_to_24"
age[(age$AGEP < 29 & age$AGEP >= 25), "group"] <- "age_25_to_29"
age[(age$AGEP < 34 & age$AGEP >= 30), "group"] <- "age_30_to_34"
age[(age$AGEP < 39 & age$AGEP >= 35), "group"] <- "age_35_to_39"
age[(age$AGEP < 44 & age$AGEP >= 40), "group"] <- "age_40_to_44"
age[(age$AGEP < 49 & age$AGEP >= 45), "group"] <- "age_45_to_49"
age[(age$AGEP < 54 & age$AGEP >= 50), "group"] <- "age_50_to_54"
age[(age$AGEP < 59 & age$AGEP >= 55), "group"] <- "age_55_to_59"
age[(age$AGEP < 64 & age$AGEP >= 60), "group"] <- "age_60_to_64"
age[(age$AGEP < 69 & age$AGEP >= 65), "group"] <- "age_65_to_69"
age[(age$AGEP < 74 & age$AGEP >= 70), "group"] <- "age_70_to_74"
age[(age$AGEP < 79 & age$AGEP >= 75), "group"] <- "age_75_to_79"
age[(age$AGEP < 84 & age$AGEP >= 80), "group"] <- "age_80_to_84"
age[(age$AGEP >= 85), "group"] <- "age_85_over"

t <- age %>% group_by(ST) %>% count(group) %>% pivot_wider(names_from = ST, values_from = n)

```

```{r}
cit <- brazil_pop_2018[,c("ST","CIT")]
cit$group <- "US_citizen"
cit[(cit$CIT =="1"),"group"] <- "US_citizen"
cit[(cit$CIT =="2"),"group"] <- "US_citizen"
cit[(cit$CIT =="3"),"group"] <- "US_citizen"
cit[(cit$CIT =="4"),"group"] <- "US_citizen"
cit[(cit$CIT =="5"),"group"] <- "Non_US_citizen"
t2<- cit %>% group_by(ST) %>% count(group) %>% pivot_wider(names_from = ST, values_from = n)

cit <- brazil_pop_2018[,c("ST","CIT")]
cit$group <- "US_citizen"


```

##PartII 
Countries' Household Datasets
```{r}
household_2018 <- get_pums(
  variables = c("POBP","HHT","CONP", "RNTP","NPF","POVPIP","OCPIP","GRPIP","ACR","HINCP","FINCP"),
  state = "all",
  survey = "acs1",
  year = 2018
)

brazil_hr_2018<- grep("362", 
                      household_2018$POBP, 
                      ignore.case = T)

brazil_hou_2018 <- household_2018 %>% slice(brazil_hr_2018, preserve = FALSE)


argentina_hr_2018<- grep("360", 
                         household_2018$POBP, 
                         ignore.case = T)

argentina_hou_2018 <- household_2018 %>% slice(argentina_hr_2018, preserve = FALSE)

bolivia_hr_2018<- grep("361", 
                       household_2018$POBP, 
                       ignore.case = T)

bolivia_hou_2018 <- household_2018%>% slice(bolivia_hr_2018, preserve = FALSE)

chile_hr_2018<- grep("363", 
                     household_2018$POBP, 
                     ignore.case = T)

chile_hou_2018 <- household_2018 %>% slice(chile_hr_2018, preserve = FALSE)

colombia_hr_2018<- grep("364", 
                        household_2018$POBP, 
                        ignore.case = T)

colombia_hou_2018 <- household_2018%>% slice(colombia_hr_2018, preserve = FALSE)

ecuador_hr_2018<- grep("365", 
                       household_2018$POBP, 
                       ignore.case = T)

ecuador_hou_2018 <- household_2018 %>% slice(ecuador_hr_2018, preserve = FALSE)

french_guiana_hr_2018<- grep("367", 
                             household_2018$POBP, 
                             ignore.case = T)

french_guiana_hou_2018 <- household_2018 %>% slice(french_guiana_hr_2018, preserve = FALSE)

guyana_hr_2018<- grep("368", 
                      household_2018$POBP, 
                      ignore.case = T)

guyana_hou_2018 <- household_2018 %>% slice(guyana_hr_2018, preserve = FALSE)

paraguay_hr_2018<- grep("369", 
                        household_2018$POBP, 
                        ignore.case = T)

paraguay_hou_2018 <-household_2018 %>% slice(paraguay_hr_2018, preserve = FALSE)

peru_hr_2018<- grep("370", 
                    household_2018$POBP, 
                    ignore.case = T)

peru_hou_2018 <- household_2018 %>% slice(peru_hr_2018, preserve = FALSE)

suriname_hr_2018<- grep("371", 
                        household_2018$POBP, 
                        ignore.case = T)

suriname_hou_2018 <- household_2018%>% slice(suriname_hr_2018, preserve = FALSE)

uruguay_hr_2018<- grep("372", 
                       household_2018$POBP, 
                       ignore.case = T)

uruguay_hou_2018 <- household_2018 %>% slice(uruguay_hr_2018, preserve = FALSE)

venezuela_hr_2018<- grep("373", 
                         household_2018$POBP, 
                         ignore.case = T)

venezuela_hou_2018 <- household_2018 %>% slice(venezuela_hr_2018, preserve = FALSE)






```


```{r}

```


```{r}

```

